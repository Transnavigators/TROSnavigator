sudo: required

services:
  - docker

# It is not really needed, other than for showing correct language tag in Travis CI build log.
language: python

env:
  global:
    - ROS_DISTRO=kinetic
    - ROS_CI_DESKTOP=xenial
    - CI_SOURCE_PATH=/travis
    - ROSINSTALL_FILE=$CI_SOURCE_PATH/dependencies.rosinstall

before_install:
  - docker pull ros
  - docker run -t $ROS_DISTRO-ros-core-$ROS_CI_DESKTOP -v $(pwd):/$CI_SOURCE_PATH tail -f /dev/null
  - docker ps

install:
  - docker network create foo
  - docker exec -t ubuntu-test bash -c "sudo sh -c "echo \"deb http://packages.ros.org/ros/ubuntu $ROS_CI_DESKTOP main\" > /etc/apt/sources.list.d/ros-latest.list";
    apt-key adv --keyserver hkp://ha.pool.sks-keyservers.net:80 --recv-key 421C365BD9FF1F717815A3895523BAEEB01FA116;
    apt-get update -qq;
    apt-get install -y python-catkin-pkg python-rosdep python-wstool ros-$ROS_DISTRO-ros-base python-rosinstall python-rosinstall-generator build-essential;
    source /opt/ros/$ROS_DISTRO/setup.bash;
    rosdep init;
    rosdep update"

before_script:
  - docker exec -t ubuntu-test bash -c "mkdir -p catkin_ws/src;
    ln -s /travis ./catkin_ws/src;
    cd ./catkin_ws/src;
    wstool init;
    if [[ -f $ROSINSTALL_FILE ]] ; then wstool merge $ROSINSTALL_FILE ; fi;
    wstool up;
    cd ..;
    rosdep install -y --from-paths src --ignore-src --rosdistro $ROS_DISTRO;
    cd .."

script:
    docker exec -t ubuntu-test bash -c "source /opt/ros/$ROS_DISTRO/setup.bash &&
    cd ./catkin_ws/src &&
    catkin_init_workspace &&
    cd .. &&
    catkin_make &&
    source devel/setup.bash &&
    roslaunch ./src/TROSnagivator.xml"